<!doctype html>
<html>
<?php
$img = '';
if (is_array($pic)) {
	$img = $pic[1];
	$pic = $pic[0];
}
?>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title><?=$title?></title>
<link rel="stylesheet" type="text/css" href="/css/wx.css?v=24" />
<?php if (!$tongji) { echo '<script src="/js/stat.js?v=1"></script>'; } ?>
</head>

<body>
<div class="container">
<header>
	<h4 class="encoded">
		æœ¬é¡µå¯èƒ½å·²è¢«é‡æ–°æ’ç‰ˆï¼Œè¯·ç‚¹å‡»ä¸Šé¢çš„
		<a href="<?=$source_url?>">åŸç½‘é¡µ</a>ï¼Œå†ç‚¹å‡»
		<a href="<?=$source_url?>">è®¿é—®åŸç½‘é¡µ</a>ï¼›
		å»ºè®®æ‚¨å¤åˆ¶ä¸‹é¢çš„é“¾æ¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ï¼
	</h4>
	<h4 class="encoded" style="display: none">
		ç‚¹å‡»å³ä¸Šè§’... é€‰æ‹©åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œ
		æ‚¨æ­£åœ¨ä½¿ç”¨çš„<?=$device?>å¯èƒ½æ— æ³•æ­£å¸¸æŸ¥çœ‹ï¼
		ä¸‹é¢æ˜¯æœ¬é¡µé“¾æ¥åœ°å€ã€‚
	</h4>
	<h4 class="encoded" style="display: none; " id="taobao_tip">
		coupon.ren ä»…ä½œä¸ºçŸ­é“¾æ¥è´­ç‰©åˆ†äº«ï¼Œè¯·æ”¾å¿ƒä½¿ç”¨ï¼
	</h4>
	<div style="padding: 10px" contenteditable="true">
		<?=$cmd_url?>
	</div>
</header>

<div id="progress_bar">
	<progress value="20" max="100"></progress>
</div>

<main>
	<div class="entry">
		<div id="item"><?php if ($pic) { echo "<img src=\"$pic\" />"; } ?></div><!-- img/alipay_newuser.png-->
		<div id="token" data-img="<?=$img?>" style="display: none"><?php if ($img) { echo "<img src=\"$img\" />"; } ?></div>
		<h3>
			<a href="<?=$url?>" id="target_url"><?=$name?></a>
		</h3>
		<div class="description">
			<?=$description?>
		</div>
	</div>
</main>

<article>	
	<?php
		if ($qr) {
	?>
	<fieldset>
		<legend>æ‰«ç é¢†åˆ¸è´­ä¹°</legend>
		<div style="text-align: center; padding: 10px"><img src="<?=$qr?>" /></div><!-- img/alipay_newuser_qr.png-->
		<div style="text-align: center; padding: 0 0 10px 0; font-size: 14px">ä¿å­˜å›¾ç‰‡æˆ–æˆªå±ï¼Œå†ç”¨<a href="taobao://">æ‰‹æœºæ·˜å®</a>æ‰«ä¸€æ‰«</div>
	</fieldset>
	<?php
		}
	
		$slh = '';
		if (in_array($type, ['shortening'])) {
			// $second = 3;
			$slh = 'hide';
		}
		
		if (preg_match("/^(\\$|Â¥|â‚¬)/", $code)) {
	?>
	<fieldset>
		<legend>æ·˜å£ä»¤</legend>
		<div style="padding: 10px">
			<div id="zhanwei"></div>
			<div id="taokouling_wenan" style="display: block; word-wrap: break-word;" contenteditable="true">
				ã€<?=$name?>ã€‘ï¼Œå¾©Â·åˆ¶è¿™æ®µæè¿° 
				<a href="<?=$cmd_url?>"><?=$cmd_url?></a> 
				åå’‘é–ğŸ‘‰æ‰‹æœºæ·˜å®ğŸ‘ˆæˆ–è€…ç”¨æµè§ˆå™¨å’‘é–æŸ¥çœ‹
			</div>
		</div>
	</fieldset>
	<?php
		}
		
		if (!in_array($client, ['MicroMessenger', 'TB'])) {
	?>
	<fieldset id="share">
		<legend>çŸ­é“¾æ¥</legend>
		<div style="padding: 10px; text-align: center;">
			<a href="<?=$cmd_url?>"><?=$cmd_url?></a>
		</div>
<?php
		if ($url_encode) {
			echo <<<HEREDOC
		<div style="padding: 10px; text-align: center;">
			<div style="font-size: 14px">QQå¯ä»¥ç”¨ç¼–ç è¿‡çš„URL</div>
			<a href="$url_encode">$url_encode</a>
		</div>
HEREDOC;
		}
?>
	</fieldset>
	<?php
		}
	?>
	<fieldset>
		<legend>æ‰“å¼€æ–¹å¼</legend>
		<div style="padding: 10px; text-align: center;">
			<a href="tbopen://<?=$open_url?>" id="tbopen_url">æ‰‹æœºæ·˜å®</a>
			<!--a href="taobao://<?=$open_url?>" id="taobao_url">æ‰‹æœºæ·˜å®</a--> | 
			<a href="tmall://page.tm/webview?url=<?=urlencode($command_url)?>">å¤©çŒ«</a> | 
			<a href="alipays://platformapi/startapp?appId=20000067&url=<?=urlencode($command_url)?>">æ”¯ä»˜å®</a> | 
			<a href="weixin://">å¾®ä¿¡</a>
		</div>
	</fieldset>
	<fieldset>
		<legend>æ›´å¤šä¼˜æƒ åˆ¸</legend>
		<div style="padding: 10px; text-align: center;">
			<a href="https://coupons.name/">www.coupons.name</a>
		</div>
	</fieldset>
</article>

<div class="bottom">
</div>

<footer style="">	
	<a href="javascript:share();" id="share_button">æˆ‘è¦åˆ†äº«</a>
	<a href="<?=$url?>" class="open" id="open_button">ç«‹å³æ‰“å¼€</a>
	<div id="count_down"><time><?=$second?></time><span> ç§’åè·³è½¬</span><var class="<?=$slh?>"></var></div>
</footer>
</div>

<script>
//ä¿ç•™ä¸¤ä½å°æ•° 
 //åŠŸèƒ½ï¼šå°†æµ®ç‚¹æ•°å››èˆäº”å…¥ï¼Œå–å°æ•°ç‚¹å2ä½ 
 function toDecimal(x, y) { 
 y = y || 100;
  var f = parseFloat(x); 
  if (isNaN(f)) { 
  return; 
  } 
  f = Math.round(x*y)/y; 
  return f; 
 } 
 
var ms = 0,
	s = Number( <?=$second?> ),
	// shang = ( 10 < s ) ?   :s / 10,
	shang = 10 / s,
	jishu = toDecimal( shang );
	// document.title = JSON.stringify([<?=$second?>, s, shang, jishu]);

if ( 'undefined' != typeof taokouling_wenan ) {
	taokouling_wenan.style.display = 'none';
	taokouling_wenan.style.width = zhanwei.offsetWidth + 'px';
	taokouling_wenan.style.display = 'block';
}

var main = document.getElementsByTagName( 'main' )[0];
var footer = document.getElementsByTagName( 'footer' )[0];
var progress = document.getElementsByTagName( 'progress' )[0];
var time = document.getElementsByTagName( 'time' )[0];
var var_tag = document.getElementsByTagName( 'var' )[0];
var h4 = document.getElementsByTagName( 'h4' );
var header = document.getElementsByTagName( 'header' )[0];

var client = '<?=$client?>'
if (!client) { //æ­£å¸¸
	header.style.display = 'none';
	progress.style.display = 'block';
	main.style.padding = '5px 0 0 0';
	<?php
	/*if (!$slh) {
	?>
		setTimeout("tbopen_url.click();", 1000);
	<?php
	}*/
	?>
	
} else if ('TB' == client) { //æ·˜å®
	h4[0].style.display = 'none';
	h4[2].style.display = 'block';
	setTimeout("taobao_tip.style.padding = '10px';", 2000);
} else if ( ! client.match( /^(AP)$/i ) ) { //å…¶ä»–APP
	setTimeout( "browser_tip();", 700 );
}

function browser_tip() {
	h4[0].style.display = 'none';
	h4[1].style.display = 'block';
}
	
<?php
// å¾®ä¿¡
if (!in_array($client, ['MicroMessenger'])) {
?>
footer.style.display = 'block';// 
var progress_val = self.setInterval( "progress_value()", 100 );
var time_val = self.setInterval( "time_value()", 1000 );
<?php
} 
/*
else {
	echo <<<HEREDOC
	zhanwei.innerHTML = target_url.href;
HEREDOC;
}
*/
?>


function progress_value() {
	ms = ms + jishu;
	var dec = toDecimal( ms, 100 );
	var rou = Math.round( dec );
	// console.log(JSON.stringify( [ms, dec, rou, jishu] ));
	var_tag.innerHTML = repeat( '.' , rou % 7 );
	progress.setAttribute( 'value', rou );
	if ( 100 <= rou ) {
		progress_val = window.clearInterval( progress_val );
		progress_bar.style.display = 'none';
		main.style.padding = '0';
	}
	
}

function time_value() {
	s--;
	time.innerHTML = s;
	// document.title = s;
	if ( 0 == s ) {
		document.getElementById( 'target_url' ).click();// 
		time_val = window.clearInterval( time_val );
	}
}

function share()
{
	time_val = window.clearInterval( time_val );
	progress_val = window.clearInterval( progress_val );
	progress_bar.style.display = share_button.style.display = count_down.style.display = open_button.style.float = 'none';
	main.style.padding = '0';
	if (token.getAttribute('data-img')) {
		item.style.display = 'none';
		token.style.display = 'block';
	}
}

function repeat(str , n){

return new Array(n+1).join(str);

}
</script>
</body>
</html>
